/*! tao 26-08-2015 */
!function(a,b){"use strict";function c(b,c){function e(){return"string"!=typeof b.name||b.name.length<4?(i("name"),!1):"string"!=typeof b.url||b.url.length<10?(i("url"),!1):"string"!=typeof b.id||20!=b.id.length?(i("id"),!1):!0}function f(a){a.map(function(a){r.child(a).onDisconnect().remove()})}function g(b){var c=b.child("input").val(),d=b.child("output").val();s._outputRef=new a.Firebase(p+"/channels/"+d),s._inputRef=new a.Firebase(p+"/channels/"+c),s._outputRef.onDisconnect().remove(),s.onReadyCallback(b.val())}function h(a){a.val()&&(c.api(r.child("api"),a.val()),n.set(a.val()))}function i(a){console.log("*** TaoConnect has encountered an error: "+a+" ***")}function j(a){r.once("value",a)}function k(a){s.onReadyCallback=a}function l(a){function b(){"input"==t?m=s._inputRef.child(u).child(q):"output"==t&&(m=s._outputRef.child(u).child(q)),n=r.child("channels").child(t).child(q),c(),n.child("enabled").on("value",function(a){var b=a.val()?"enabled":"disabled";console.log("Channel "+t+" "+q+" "+b),a.val()?c():e()}),m.child("enabled").on("value",function(a){if(a.val()==k)a.val()?c():e();else{var b=a.val()?"enabled":"disabled";console.log("Illegal channel "+t+" "+q+" "+b+" event received."),m.child("enabled").set(k)}})}function c(){k=!0,n.child("enabled").set(!0),m.child("enabled").set(!0)}function e(){k=!1,n.child("enabled").set(!1),m.child("enabled").set(!1)}function f(){return k}function g(a){var b=function(b){if(f){var c=b.val();console.log("Data read from "+t+" "+q+": "+c),a(c)}else a(l)};m.child("data").once("value",b)}function h(a){var b=function(b){console.log("Datachange event. Channel enabled: "+f()),f()&&a(b.val()),m.child("data").remove()};m.child("data").on("value",b)}function i(){m.child("data").off("value")}function j(a){f()?m.child("data").set(a):console.log("Could not set data. Channel is disabled.")}var k,l,m,n,o={dataFormat:"midi"},p=d(o,a),q=p.name,t=p.type,u=p.dataFormat;this.setData=j,this.disconnect=i,this.getData=g,this.enable=c,this.disable=e,this.isEnabled=f,this.watch=h,b(),g(function(a){l=a})}function m(a,b){function c(a){h.child("statusLog").push(a),g.statusMessages[a]?h.child("statusDescription").add(g.statusMessages[a]):h.child("statusDescription").add("Unknown status")}function e(a){a&&(h.child("status").push(a),g.statusMessages[a]?h.child("statusDescription").set(g.statusMessages[a]):h.child("statusDescription").set("Unknown status"),g.logEnabled&&c(a))}var f={statusMessages:{},logEnabled:!0},g=d(f,b),h=r.child("moduleStatus").child(a);this.set=e}var n,o=b.name,p=b.url,q=b.id,r=new a.Firebase(p+"/metadata/"+q),s={};return function(){return e()?(n=new m(c.name,c.statusMessages),r.child("name").set(o),r.child("isTurnedOn").set(!0),f(["isTurnedOn","moduleStatus"]),r.once("value",g),void r.child("api").on("value",h)):!1}(),s.getMetadata=j,s.onReady=k,s.Channel=l,s.Status=m,s}function d(a,b){var c,d={};for(c in a)Object.prototype.hasOwnProperty.call(a,c)&&(d[c]=a[c]);for(c in b)Object.prototype.hasOwnProperty.call(b,c)&&(d[c]=b[c]);return d}module.exports=c,c.VERSION="0.0.0",a.Tao=c}(this);