/*! tao 31-08-2015 */
"use strict";function Tao(a,b){function c(){return d()?(n=new m(b.name,b.statusMessages),s.child("name").set(p),s.child("isTurnedOn").set(!0),e(["isTurnedOn"]),s.once("value",f),void s.child("api").on("value",g)):!1}function d(){return"string"!=typeof a.name||a.name.length<4?(h("name"),!1):"string"!=typeof a.url||a.url.length<10?(h("url"),!1):"string"!=typeof a.id||20!=a.id.length?(h("id"),!1):!0}function e(a){a.map(function(a){s.child(a).onDisconnect().remove()})}function f(a){var b=a.child("input").val(),c=a.child("output").val();t._outputRef=new Firebase(q+"/channels/"+c),t._inputRef=new Firebase(q+"/channels/"+b),t.onReadyCallback(a.val()),o=new m("tao",{})}function g(a){a.val()&&(b.api(s.child("api"),a.val()),n.set(a.val()))}function h(a){console.log("*** TaoConnect has encountered an error: "+a+" ***")}function i(a,b){var c,d={};for(c in a)Object.prototype.hasOwnProperty.call(a,c)&&(d[c]=a[c]);for(c in b)Object.prototype.hasOwnProperty.call(b,c)&&(d[c]=b[c]);return d}function j(a){s.once("value",a)}function k(a){t.onReadyCallback=a}function l(a){function b(){"input"==w?p=t._inputRef.child(x).child(v):"output"==w&&(p=t._outputRef.child(x).child(v)),q=s.child("channels").child(w).child(v),c(),q.child("enabled").on("value",function(a){var b=a.val()?"enabled":"disabled";console.log("Channel "+w+" "+v+" "+b),a.val()?c():d()}),p.child("enabled").on("value",function(a){if(a.val()==n)a.val()?c():d();else{var b=a.val()?"enabled":"disabled";console.log("Channel "+b+": "+w+" "+v)}})}function c(){n=!0,q.child("enabled").set(!0),p.child("enabled").set(!0)}function d(){n=!1,q.child("enabled").set(!1),p.child("enabled").set(!1)}function e(){return n}function f(a){var b=function(b){if(e()){var c=b.val();console.log("Data read from "+w+" "+v+": "+c),a(c)}else a(o)};p.child("data").once("value",b)}function g(a){var b=function(b){console.log("Datachange event. Channel enabled: "+e()),e()&&a(b.val())};p.child("data").on("value",b),p.child("data").once("value",b)}function h(a){var b=function(b){b.val()&&a()};p.child("enabled").on("value",b),p.child("enabled").once("value",b)}function j(a){var b=function(b){b.val()||a()};p.child("enabled").on("value",b),p.child("enabled").once("value",b)}function k(){p.child("data").off("value")}function l(a){e()?p.child("data").set(a):console.log("Could not set data. Channel is disabled.")}function m(){p.child("data").onDisconnect().remove()}var n,o,p,q,r={dataFormat:"midi"},u=i(r,a),v=u.name,w=u.type,x=u.dataFormat;this.setData=l,this.disconnect=k,this.getData=f,this.enable=c,this.disable=d,this.isEnabled=e,this.removeOnDisconnect=m,this.watch=g,this.onEnable=h,this.onDisable=j,b(),f(function(a){o=a})}function m(a,b){function c(a){var b=new Date;g.child("statusLog").child(b.toString()).set(a)}function d(a){a&&(g.child("status").set(a),g.child("statusDescription").set(f.statusMessages[a]?f.statusMessages[a]:"Unknown status"),f.logEnabled&&c(a))}var e={statusMessages:{},logEnabled:!0},f=i(e,b),g=s.child("moduleStatus").child(a);this.set=d}var n,o,p=a.name,q=a.url,r=a.id,s=new Firebase(q+"/metadata/"+r),t={};return t.getMetadata=j,t.onReady=k,t.Channel=l,t.Status=m,c(),t}Tao.VERSION="0.0.1";